(function(e){var t=acf.media;acf.fields.file={$el:null,$input:null,o:{},set:function(t){e.extend(this,t);this.$input=this.$el.find('input[type="hidden"]');this.o=acf.helpers.get_atts(this.$el);this.o.multiple=this.$el.closest(".repeater").exists()?!0:!1;this.o.query={};this.o.library=="uploadedTo"&&(this.o.query.uploadedTo=acf.o.post_id);return this},init:function(){if(acf.helpers.is_clone_field(this.$input))return},add:function(e){var n=t.div;n.find(".acf-file-icon").attr("src",e.icon);n.find(".acf-file-title").text(e.title);n.find(".acf-file-name").text(e.name).attr("href",e.url);n.find(".acf-file-size").text(e.size);n.find(".acf-file-value").val(e.id).trigger("change");n.addClass("active");n.closest(".field").removeClass("error")},edit:function(){t.div=this.$el;tb_show(acf.l10n.file.edit,acf.o.admin_url+"media.php?attachment_id="+this.$input.val()+"&action=edit&acf_action=edit_attachment&acf_field=file&TB_iframe=1")},remove:function(){this.$el.find(".acf-file-icon").attr("src","");this.$el.find(".acf-file-title").text("");this.$el.find(".acf-file-name").text("").attr("href","");this.$el.find(".acf-file-size").text("");this.$el.find(".acf-file-value").val("").trigger("change");this.$el.removeClass("active")},popup:function(){var n=this;t.div=this.$el;if(t.type()=="backbone"){t.clear_frame();t.frame=wp.media({states:[new wp.media.controller.Library({library:wp.media.query(n.o.query),multiple:n.o.multiple,title:acf.l10n.file.select,priority:20,filterable:"all"})]});acf.media.frame.on("content:activate",function(){var t=null,r=null;try{t=acf.media.frame.content.get().toolbar;r=t.get("filters")}catch(i){}if(!r)return!1;if(n.o.library=="uploadedTo"){r.$el.find('option[value="uploaded"]').remove();r.$el.after("<span>"+acf.l10n.file.uploadedTo+"</span>");e.each(r.filters,function(e,t){t.props.uploadedTo=acf.o.post_id})}});acf.media.frame.on("select",function(){selection=t.frame.state().get("selection");if(selection){var e=0;selection.each(function(n){e++;if(e>1){var r=t.div.closest("td").attr("data-field_key"),s=t.div.closest("tr"),o=s.closest(".repeater");if(s.next(".row").exists())t.div=s.next(".row").find('td[data-field_key="'+r+'"] .acf-file-uploader');else{o.find(".add-row-end").trigger("click");t.div=o.find('> table > tbody > tr.row:last td[data-field_key="'+r+'"] .acf-file-uploader')}}var u={id:n.id,title:n.attributes.title,name:n.attributes.filename,url:n.attributes.url,icon:n.attributes.icon,size:n.attributes.filesize};acf.fields.file.add(u)})}});acf.media.frame.open()}else tb_show(acf.l10n.file.select,acf.admin_url+"media-upload.php?post_id="+acf.o.post_id+"&post_ID="+acf.post_id+"&type=file&acf_type=file&TB_iframe=1");return!1}};e(".acf-file-uploader .acf-button-edit").live("click",function(){acf.fields.file.set({$el:e(this).closest(".acf-file-uploader")}).edit();return!1});e(".acf-file-uploader .acf-button-delete").live("click",function(){acf.fields.file.set({$el:e(this).closest(".acf-file-uploader")}).remove();return!1});e(".acf-file-uploader .add-file").live("click",function(){acf.fields.file.set({$el:e(this).closest(".acf-file-uploader")}).popup();return!1})})(jQuery);